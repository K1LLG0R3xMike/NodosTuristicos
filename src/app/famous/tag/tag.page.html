<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Tags</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Tags</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="container">
    <!-- Botón de cámara (mostrar solo si no hay foto) -->
    <div class="camera-section" *ngIf="!isPhotoTaken">
      <ion-button 
        expand="full" 
        size="large" 
        color="primary"
        (click)="takePhoto()"
        class="camera-button">
        <ion-icon name="camera" slot="start"></ion-icon>
        Tomar Foto
      </ion-button>
      
      <p class="camera-instruction">
        Presiona el botón para activar la cámara y tomar una foto
      </p>
    </div>

    <!-- Vista previa de la foto y formulario -->
    <div class="photo-form-section" *ngIf="isPhotoTaken && capturedPhoto">
      
      <!-- Vista previa de la foto -->
      <div class="photo-preview">
        <img 
          #photoPreview
          [src]="capturedPhoto" 
          alt="Foto capturada"
          class="captured-photo">
        
        <!-- Botones de acción para la foto -->
        <div class="photo-actions">
          <ion-button 
            fill="outline" 
            color="medium"
            (click)="retakePhoto()"
            size="small">
            <ion-icon name="camera" slot="start"></ion-icon>
            Retomar
          </ion-button>
          
          <ion-button 
            fill="outline" 
            color="danger"
            (click)="cancelPhoto()"
            size="small">
            <ion-icon name="close" slot="start"></ion-icon>
            Cancelar
          </ion-button>
        </div>
      </div>

      <!-- Formulario de tag -->
      <div class="tag-form">
        <ion-card>
          <ion-card-header>
            <ion-card-title>Agregar Tag</ion-card-title>
            <ion-card-subtitle>Completa la información del tag</ion-card-subtitle>
          </ion-card-header>
          
          <ion-card-content>
            
            <!-- Selector de famoso -->
            <ion-item>
              <ion-select 
                [(ngModel)]="selectedFamous"
                placeholder="Selecciona un famoso"
                interface="popover">
                <ion-select-option 
                  *ngFor="let famous of famousList" 
                  [value]="famous._id">
                  {{ famous.name }}
                </ion-select-option>
              </ion-select>
              <ion-label position="stacked">Famoso *</ion-label>
            </ion-item>

            <!-- Comentario -->
            <ion-item>
              <ion-label position="stacked">Comentario</ion-label>
              <ion-textarea 
                [(ngModel)]="comment"
                placeholder="Escribe un comentario (opcional)"
                rows="3"
                maxlength="500">
              </ion-textarea>
            </ion-item>

            <!-- Información de ubicación -->
            <ion-item *ngIf="currentLocation">
              <ion-label>
                <h3>Ubicación</h3>
                <p>Lat: {{ currentLocation.lat | number:'1.6-6' }}</p>
                <p>Lng: {{ currentLocation.lng | number:'1.6-6' }}</p>
              </ion-label>
              <ion-icon name="location" slot="end" color="primary"></ion-icon>
            </ion-item>

          </ion-card-content>
        </ion-card>

        <!-- Botones del formulario -->
        <div class="form-actions">
          <ion-button 
            expand="full" 
            color="success"
            (click)="saveTag()"
            [disabled]="!selectedFamous">
            <ion-icon name="save" slot="start"></ion-icon>
            Guardar Tag
          </ion-button>
        </div>

      </div>
    </div>

    <!-- Mensaje de estado -->
    <div class="status-message" *ngIf="!isPhotoTaken">
      <ion-icon name="information-circle" color="medium"></ion-icon>
      <p>Para crear un tag, primero toma una foto</p>
    </div>

  </div>

</ion-content>